<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Cartohound – Stable Build</title>

<link href="https://unpkg.com/maplibre-gl@4.7.1/dist/maplibre-gl.css" rel="stylesheet">
<script src="https://unpkg.com/maplibre-gl@4.7.1/dist/maplibre-gl.js"></script>

<style>
html, body {
  margin: 0;
  height: 100%;
  font-family: Inter, system-ui, sans-serif;
}

#map-streets, #map-hybrid {
  position: absolute;
  inset: 0;
}

#map-hybrid { display: none; }

/* Search */
#searchWrap {
  position: absolute;
  top: 15px;
  left: 15px;
  z-index: 10;
  width: 280px;
}

#search {
  width: 100%;
  padding: 10px 14px;
  font-size: 15px;
  border-radius: 999px;
  border: 1px solid #bbb;
}

#results {
  margin-top: 6px;
  background: white;
  border-radius: 12px;
  border: 1px solid #ccc;
  overflow: hidden;
  display: none;
}

.result {
  padding: 8px 12px;
  cursor: pointer;
}
.result:hover { background: #eee; }

/* Buttons */
#buttons {
  position: absolute;
  bottom: 20px;
  left: 20px;
  z-index: 10;
  display: flex;
  gap: 10px;
}

.btn {
  width: 44px;
  height: 44px;
  border-radius: 10px;
  border: 1px solid #ccc;
  background: white;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
}

.btn img, .btn svg {
  width: 22px;
  height: 22px;
}
</style>
</head>

<body>

<div id="map-streets"></div>
<div id="map-hybrid"></div>

<div id="searchWrap">
  <input id="search" placeholder="Search location">
  <div id="results"></div>
</div>

<div id="buttons">
  <div id="toggleLayer" class="btn">
    <img src="https://raw.githubusercontent.com/finnhound/cartohound/7b3c8e14c393450a26d9d562c99016afad43d83a/stack%20(1).svg">
  </div>
</div>

<script>
/* ================== CONFIG ================== */
const MT_KEY = "kUOJqqeRX1BMaXctsgK5";
const ORS_KEY = "eyJvcmciOiI1YjNjZTM1OTc4NTExMTAwMDFjZjYyNDgiLCJpZCI6IjFjMzkyNDVlOGIyNjQxYjVhMDRhNWEwNjdlMTM4MDc0IiwiaCI6Im11cm11cjY0In0=";

const STREETS = `https://api.maptiler.com/maps/019b2817-43ac-7a98-b15b-c204722a617b/style.json?key=${MT_KEY}`;
const HYBRID  = `https://api.maptiler.com/maps/hybrid/style.json?key=${MT_KEY}`;

/* ================== MAPS ================== */
const mapStreets = new maplibregl.Map({
  container: "map-streets",
  style: STREETS,
  center: [0, 0],
  zoom: 2,
  attributionControl: true,
  preserveDrawingBuffer: true
});

const mapHybrid = new maplibregl.Map({
  container: "map-hybrid",
  style: HYBRID,
  center: [0, 0],
  zoom: 2,
  attributionControl: true,
  preserveDrawingBuffer: true
});

/* Proper attribution */
[mapStreets, mapHybrid].forEach(m => {
  m.addControl(new maplibregl.AttributionControl({
    compact: true,
    customAttribution: [
      "© OpenStreetMap contributors",
      "© MapTiler",
      "© openrouteservice.org by HeiGIT"
    ]
  }));
  m.addControl(new maplibregl.NavigationControl(), "bottom-right");
});

/* ================== SYNC ================== */
let syncing = false;
function sync(a, b) {
  if (syncing) return;
  syncing = true;
  b.jumpTo({ center: a.getCenter(), zoom: a.getZoom() });
  syncing = false;
}
mapStreets.on("move", () => sync(mapStreets, mapHybrid));
mapHybrid.on("move", () => sync(mapHybrid, mapStreets));

/* ================== TOGGLE ================== */
let hybrid = false;
toggleLayer.onclick = () => {
  hybrid = !hybrid;
  document.getElementById("map-streets").style.display = hybrid ? "none" : "block";
  document.getElementById("map-hybrid").style.display  = hybrid ? "block" : "none";
  (hybrid ? mapHybrid : mapStreets).resize();
};

/* ================== SEARCH ================== */
const search = document.getElementById("search");
const results = document.getElementById("results");
let pin = null;

search.addEventListener("input", () => {
  const q = search.value.trim();
  if (!q) { results.style.display = "none"; return; }

  fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(q)}`)
    .then(r => r.json())
    .then(list => {
      results.innerHTML = "";
      if (!list.length) return;
      list.slice(0, 5).forEach(p => {
        const d = document.createElement("div");
        d.className = "result";
        d.textContent = p.display_name;
        d.onclick = () => {
          results.style.display = "none";
          search.value = "";

          if (pin) pin.remove();
          const m = hybrid ? mapHybrid : mapStreets;

          pin = new maplibregl.Marker()
            .setLngLat([+p.lon, +p.lat])
            .addTo(m);

          m.flyTo({ center: [+p.lon, +p.lat], zoom: 14 });
        };
        results.appendChild(d);
      });
      results.style.display = "block";
    });
});

document.addEventListener("click", e => {
  if (!results.contains(e.target) && e.target !== search)
    results.style.display = "none";
});
</script>

</body>
</html>
