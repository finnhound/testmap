<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Cartohound Map</title>

<link href="https://unpkg.com/maplibre-gl@4.7.1/dist/maplibre-gl.css" rel="stylesheet">
<script src="https://unpkg.com/maplibre-gl@4.7.1/dist/maplibre-gl.js"></script>

<style>
html, body {
  margin:0;
  height:100%;
  font-family: Inter, system-ui, sans-serif;
}
.map { position:absolute; inset:0; }

/* ---------- SEARCH + ROUTING PANEL ---------- */
#controls {
  position:absolute;
  top:20px;
  left:20px;
  z-index:20;
  display:flex;
  flex-direction:column;
  gap:10px;
}

#searchBox {
  width:260px;
  padding:10px 14px;
  font-size:15px;
  border-radius:999px;
  border:1px solid #ccc;
  outline:none;
}

#searchResults {
  background:white;
  border-radius:12px;
  border:1px solid #ccc;
  overflow:hidden;
  display:none;
}

.searchItem {
  padding:10px 14px;
  cursor:pointer;
}
.searchItem:hover { background:#eee; }

/* Routing dropdown */
#routingToggle {
  background:#fff;
  border:1px solid #ccc;
  padding:8px 12px;
  border-radius:10px;
  cursor:pointer;
}

#routingPanel {
  display:none;
  flex-direction:column;
  gap:8px;
  padding:12px;
  background:rgba(255,255,255,0.75);
  backdrop-filter: blur(6px);
  border-radius:12px;
  border:1px solid #ccc;
}

#routingPanel.open { display:flex; }

#routingPanel select,
#routingPanel button {
  padding:8px;
  border-radius:8px;
  border:1px solid #bbb;
  font-size:14px;
}

/* ---------- BOTTOM LEFT BUTTONS ---------- */
#bottomLeft {
  position:absolute;
  bottom:20px;
  left:20px;
  z-index:20;
  display:flex;
  gap:8px;
}

.iconBtn {
  width:44px;
  height:44px;
  background:white;
  border-radius:10px;
  border:1px solid #ccc;
  cursor:pointer;
  display:flex;
  align-items:center;
  justify-content:center;
}

.iconBtn img,
.iconBtn svg {
  width:22px;
  height:22px;
}

/* ---------- MAPLIBRE CONTROLS ---------- */
.maplibregl-ctrl-bottom-right {
  transform: scale(1.25);
  margin:20px;
}

/* ---------- INFO ---------- */
.route-info {
  position:absolute;
  top:20px;
  left:50%;
  transform:translateX(-50%);
  background:white;
  padding:8px 14px;
  border-radius:10px;
  border:1px solid #333;
  display:none;
  z-index:20;
}

.loading {
  position:absolute;
  top:60px;
  left:50%;
  transform:translateX(-50%);
  background:yellow;
  padding:6px 12px;
  border-radius:8px;
  display:none;
  z-index:30;
}

.attribution-text {
  position:absolute;
  bottom:10px;
  right:10px;
  background:rgba(255,255,255,0.85);
  padding:6px 10px;
  border-radius:8px;
  font-size:12px;
  z-index:20;
}

.maptiler-logo {
  position:absolute;
  left:10px;
  bottom:80px;
  z-index:20;
}
</style>
</head>

<body>

<div id="map-streets" class="map"></div>
<div id="map-hybrid" class="map" style="display:none;"></div>

<!-- SEARCH + ROUTING -->
<div id="controls">
  <input id="searchBox" placeholder="Search for a place">
  <div id="searchResults"></div>

  <button id="routingToggle">Routing ▾</button>
  <div id="routingPanel">
    <select id="mode">
      <option value="driving-car">Car</option>
      <option value="foot-walking">Walking</option>
      <option value="cycling-regular">Cycling</option>
    </select>
    <button id="resetRoute">Reset route</button>
  </div>
</div>

<!-- BOTTOM LEFT -->
<div id="bottomLeft">
  <div id="hybridToggle" class="iconBtn">
    <img src="https://raw.githubusercontent.com/finnhound/cartohound/7b3c8e14c393450a26d9d562c99016afad43d83a/stack%20(1).svg">
  </div>
  <div id="downloadMap" class="iconBtn"></div>
</div>

<div class="route-info" id="routeInfo"></div>
<div class="loading" id="loading">Loading…</div>

<div class="attribution-text">
  © openrouteservice.org | © OpenStreetMap contributors | Tiles © MapTiler
</div>

<a class="maptiler-logo" href="https://www.maptiler.com" target="_blank">
  <img src="https://api.maptiler.com/resources/logo.svg">
</a>

<script>
const ORS_KEY="eyJvcmciOiI1YjNjZTM1OTc4NTExMTAwMDFjZjYyNDgiLCJpZCI6IjFjMzkyNDVlOGIyNjQxYjVhMDRhNWEwNjdlMTM4MDc0IiwiaCI6Im11cm11cjY0In0=";
const MT_KEY="kUOJqqeRX1BMaXctsgK5";

const STREETS=`https://api.maptiler.com/maps/019b2817-43ac-7a98-b15b-c204722a617b/style.json?key=${MT_KEY}`;
const HYBRID=`https://api.maptiler.com/maps/hybrid/style.json?key=${MT_KEY}`;

const mapStreets=new maplibregl.Map({
  container:"map-streets",
  style:STREETS,
  center:[0,0],
  zoom:1,
  preserveDrawingBuffer:true
});
const mapHybrid=new maplibregl.Map({
  container:"map-hybrid",
  style:HYBRID,
  center:[0,0],
  zoom:1,
  preserveDrawingBuffer:true
});

[mapStreets,mapHybrid].forEach(m=>{
  m.addControl(new maplibregl.NavigationControl(), "bottom-right");
});

let current="streets";
hybridToggle.onclick=()=>{
  const h=current==="streets";
  mapStreets.getContainer().style.display=h?"none":"block";
  mapHybrid.getContainer().style.display=h?"block":"none";
  (h?mapHybrid:mapStreets).resize();
  current=h?"hybrid":"streets";
};

downloadMap.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="#5856d6" stroke-width="3"><path d="M9 11a3 3 0 1 0 6 0"/><path d="M17.657 16.657l-4.243 4.243a2 2 0 0 1-2.827 0l-4.244-4.243a8 8 0 1 1 11.314 0z"/></svg>`;

downloadMap.onclick=()=>{
  const map=current==="streets"?mapStreets:mapHybrid;
  controls.style.display="none";
  bottomLeft.style.display="none";
  setTimeout(()=>{
    const url=map.getCanvas().toDataURL("image/png");
    controls.style.display="flex";
    bottomLeft.style.display="flex";
    const a=document.createElement("a");
    a.href=url;
    a.download="map.png";
    a.click();
  },50);
};

routingToggle.onclick=()=>{
  routingPanel.classList.toggle("open");
};
</script>

</body>
</html>
