<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Cartohound Map</title>

<link href="https://unpkg.com/maplibre-gl@4.7.1/dist/maplibre-gl.css" rel="stylesheet">
<script src="https://unpkg.com/maplibre-gl@4.7.1/dist/maplibre-gl.js"></script>

<style>
html, body {
  margin:0;
  height:100%;
  font-family: Inter, system-ui, sans-serif;
}

.map {
  position:absolute;
  inset:0;
}

/* LEFT PANEL */
#controls {
  position:absolute;
  top:10px;
  left:10px;
  z-index:20;
  background:white;
  padding:10px;
  border:1px solid #ccc;
  border-radius:8px;
  display:flex;
  flex-direction:column;
  gap:6px;
}

#searchBox {
  width:220px;
  padding:6px;
  border-radius:6px;
  border:1px solid #ccc;
}

#searchResults {
  position:absolute;
  top:46px;
  left:10px;
  width:220px;
  background:white;
  border:1px solid #ccc;
  border-radius:6px;
  max-height:200px;
  overflow-y:auto;
  display:none;
  z-index:30;
}

.searchItem {
  padding:6px;
  cursor:pointer;
}
.searchItem:hover { background:#eee; }

/* ROUTING DROPDOWN */
#routingToggle {
  margin-top:6px;
}

#routingPanel {
  display:none;
  gap:6px;
  padding:8px;
  background:rgba(255,255,255,0.75);
  backdrop-filter: blur(6px);
  border:1px solid #ccc;
  border-radius:6px;
}

#routingPanel.open {
  display:flex;
  flex-direction:column;
}

/* TOP RIGHT STACK */
.maplibregl-ctrl-top-right {
  display:flex;
  flex-direction:column;
  gap:6px;
}

#hybridToggle,
#downloadMap {
  width:36px;
  height:36px;
  background:white;
  border:1px solid #ccc;
  border-radius:6px;
  cursor:pointer;
  display:flex;
  align-items:center;
  justify-content:center;
}

#hybridToggle.active {
  background:#ddd;
}

#hybridToggle img,
#downloadMap svg {
  width:20px;
  height:20px;
}

/* INFO */
.route-info {
  position:absolute;
  top:20px;
  left:50%;
  transform:translateX(-50%);
  background:white;
  padding:8px 14px;
  border-radius:8px;
  border:1px solid #333;
  z-index:20;
  display:none;
}

.loading {
  position:absolute;
  top:20px;
  left:50%;
  transform:translateX(-50%);
  background:yellow;
  padding:6px 12px;
  border-radius:6px;
  font-weight:bold;
  display:none;
  z-index:30;
}

.attribution-text {
  position:absolute;
  bottom:10px;
  right:10px;
  background:rgba(255,255,255,0.85);
  padding:6px 10px;
  border-radius:6px;
  font-size:12px;
  z-index:20;
}

.maptiler-logo {
  position:absolute;
  left:10px;
  bottom:10px;
  z-index:20;
}
</style>
</head>

<body>

<div id="map-streets" class="map"></div>
<div id="map-hybrid" class="map" style="display:none;"></div>

<div id="controls">
  <input id="searchBox" placeholder="Search">
  <div id="searchResults"></div>

  <button id="routingToggle">Routing ▾</button>
  <div id="routingPanel">
    <select id="mode">
      <option value="driving-car">Car</option>
      <option value="foot-walking">Walking</option>
      <option value="cycling-regular">Cycling</option>
    </select>
    <button id="resetRoute">Reset Route</button>
  </div>
</div>

<div id="hybridToggle">
  <img src="https://raw.githubusercontent.com/finnhound/cartohound/7b3c8e14c393450a26d9d562c99016afad43d83a/stack%20(1).svg">
</div>

<button id="downloadMap"></button>

<div class="route-info" id="routeInfo"></div>
<div class="loading" id="loading">Loading…</div>

<div class="attribution-text">
  © openrouteservice.org | © OpenStreetMap contributors | Tiles © MapTiler
</div>

<a class="maptiler-logo" href="https://www.maptiler.com" target="_blank">
  <img src="https://api.maptiler.com/resources/logo.svg">
</a>

<script>
/* ================= CONFIG ================= */
const ORS_KEY = "eyJvcmciOiI1YjNjZTM1OTc4NTExMTAwMDFjZjYyNDgiLCJpZCI6IjFjMzkyNDVlOGIyNjQxYjVhMDRhNWEwNjdlMTM4MDc0IiwiaCI6Im11cm11cjY0In0=";
const MT_KEY  = "kUOJqqeRX1BMaXctsgK5";

const STREETS_URL = `https://api.maptiler.com/maps/019b2817-43ac-7a98-b15b-c204722a617b/style.json?key=${MT_KEY}`;
const HYBRID_URL  = `https://api.maptiler.com/maps/hybrid/style.json?key=${MT_KEY}`;

/* ================= SVGs ================= */
const defaultPinSVG = `<svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="#5856d6" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><path d="M9 11a3 3 0 1 0 6 0"/><path d="M17.657 16.657l-4.243 4.243a2 2 0 0 1 -2.827 0l-4.244 -4.243a8 8 0 1 1 11.314 0z"/></svg>`;
const startPinSVG   = defaultPinSVG.replace("#5856d6","#00c7be");
const endPinSVG     = defaultPinSVG.replace("#5856d6","#ff9500");

/* ================= MAPS ================= */
const mapStreets = new maplibregl.Map({
  container:"map-streets",
  style:STREETS_URL,
  center:[0,0],
  zoom:1,
  preserveDrawingBuffer:true
});

const mapHybrid = new maplibregl.Map({
  container:"map-hybrid",
  style:HYBRID_URL,
  center:[0,0],
  zoom:1,
  preserveDrawingBuffer:true
});

[mapStreets,mapHybrid].forEach(m=>{
  m.addControl(new maplibregl.NavigationControl(), "top-right");
});

/* ================= EXTRA CONTROLS ================= */
function attachControls(map){
  const ctrl = map.getContainer().querySelector(".maplibregl-ctrl-top-right");
  ctrl.appendChild(document.getElementById("hybridToggle"));
  ctrl.appendChild(document.getElementById("downloadMap"));
}
attachControls(mapStreets);
attachControls(mapHybrid);

/* ================= HYBRID ================= */
let currentStyle="streets";
hybridToggle.onclick=()=>{
  const hybrid = currentStyle==="streets";
  hybridToggle.classList.toggle("active", hybrid);
  mapStreets.getContainer().style.display = hybrid?"none":"block";
  mapHybrid.getContainer().style.display  = hybrid?"block":"none";
  (hybrid?mapHybrid:mapStreets).resize();
  currentStyle = hybrid?"hybrid":"streets";
};

/* ================= DOWNLOAD ICON ================= */
downloadMap.innerHTML = defaultPinSVG.replace('width="40"','width="22"').replace('height="40"','height="22"');

/* ================= DOWNLOAD LOGIC ================= */
downloadMap.onclick=()=>{
  const map = currentStyle==="streets"?mapStreets:mapHybrid;
  controls.style.display="none";
  hybridToggle.style.display="none";
  setTimeout(()=>{
    const url = map.getCanvas().toDataURL("image/png");
    controls.style.display="flex";
    hybridToggle.style.display="flex";
    const a=document.createElement("a");
    a.href=url;
    a.download="map.png";
    a.click();
  },50);
};
</script>

</body>
</html>
